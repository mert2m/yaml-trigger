name: Trigger Shell Script on YAML Update

on:
  push:
    branches:
      - prod
    paths:
      - 'k8s/prod/*.yaml'
      - 'k8s/stg/*.yaml'

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Check for YAML changes
      id: yaml-check
      run: |
        if git diff --name-only HEAD^ HEAD | grep -qE 'k8s/(prod|stg)/.*\.yaml'; then
          echo "YAML files changed"
          echo "::set-output name=changes::true"
        else
          echo "No YAML changes"
          echo "::set-output name=changes::false"
        fi

    - name: Run Shell Script
      if: steps.yaml-check.outputs.changes == 'true'
      run: |
        chmod +x ./k8s/run-script.sh
        ./k8s/run-script.sh
